<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QA TestSphere</title>
</head>
<body>

<h2>Task Manager</h2>

<input id="taskInput" placeholder="Task name">
<button id="addTaskBtn">Add Task</button>

<ul id="taskList"></ul>

<script>
document.getElementById("addTaskBtn").addEventListener("click", async () => {
    const taskInput = document.getElementById("taskInput");
    const taskName = taskInput.value.trim();

    // ✅ Input validation
    if (!taskName) {
        console.warn("Task name is empty");
        return;
    }

    try {
        // ✅ ABSOLUTE backend URL (CI-safe)
        const response = await fetch("http://localhost:3000/add-task", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ taskName })
        });

        if (!response.ok) {
            console.error("Failed to add task");
            return;
        }

        // ✅ Render task in UI (IMPORTANT for Selenium)
        const li = document.createElement("li");
        li.textContent = taskName;
        li.setAttribute("data-task", taskName);

        // Optional: click to delete (manual testing)
        li.addEventListener("click", async () => {
            await fetch(`http://localhost:3000/delete-task/${taskName}`, {
                method: "DELETE"
            });
            li.remove();
        });

        document.getElementById("taskList").appendChild(li);

        // ✅ Clear input (better UX + test reliability)
        taskInput.value = "";

    } catch (error) {
        console.error("Error communicating with backend", error);
    }
});
</script>

</body>
</html>
